# AWS Lambda esbuild Tree Shaking Demo

AWS CDK ã¨ esbuild ã‚’ä½¿ç”¨ã—ãŸ Lambda é–¢æ•°ã®æœ€é©åŒ–ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’å®Ÿè¨¼ã™ã‚‹ã‚µãƒ³ãƒ—ãƒ«ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã™ã€‚

## ğŸ¯ ç›®çš„

- `--packages: external` ã«ã‚ˆã‚‹å¤–éƒ¨ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«é™¤å¤–ã®å®Ÿè£…æ–¹æ³•
- Tree shaking ã«ã‚ˆã‚‹ä¾å­˜æ€§åˆ†é›¢åŠ¹æœã®æ¤œè¨¼
- è¤‡æ•°ã®ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãƒ‘ã‚¿ãƒ¼ãƒ³ã®æ€§èƒ½æ¯”è¼ƒ
- å¤§è¦æ¨¡ Lambda ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®å¯†çµåˆç·©å’Œæ‰‹æ³•

## ğŸ“Š æ¤œè¨¼çµæœ

| ãƒ‘ã‚¿ãƒ¼ãƒ³ | ãƒãƒ³ãƒ‰ãƒ«ã‚µã‚¤ã‚º | èª¬æ˜ |
|---------|---------------|------|
| æœ€é©åŒ–ãªã— | 64,802 bytes | ãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³ï¼ˆå…¨ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«è¾¼ã¿ï¼‰ |
| `--packages: external` | 1,087 bytes | 98.3% å‰Šæ¸›ï¼ˆãƒ¬ã‚¤ãƒ¤ãƒ¼ä½¿ç”¨ï¼‰ |
| Tree shaking ã®ã¿ | 8,044 bytes | 87.5% å‰Šæ¸›ï¼ˆãƒ¬ã‚¤ãƒ¤ãƒ¼ãªã—ï¼‰ |

## ğŸ” ãƒ¬ã‚¤ãƒ¤ãƒ¼ä½¿ç”¨ vs ãƒ¬ã‚¤ãƒ¤ãƒ¼ãªã—ã®è©³ç´°è§£èª¬

### Lambda ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¨ã¯ï¼Ÿ
Lambda ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¯ã€è¤‡æ•°ã® Lambda é–¢æ•°ã§å…±æœ‰ã§ãã‚‹ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚„ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã‚³ãƒ¼ãƒ‰ã‚’å«ã‚€ ZIP ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ã§ã™ã€‚å¤–éƒ¨ä¾å­˜é–¢ä¿‚ï¼ˆnode_modulesï¼‰ã‚’ Lambda é–¢æ•°æœ¬ä½“ã‹ã‚‰åˆ†é›¢ã—ã€å†åˆ©ç”¨å¯èƒ½ã«ã—ã¾ã™ã€‚

### ãƒ¬ã‚¤ãƒ¤ãƒ¼ä½¿ç”¨ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼ˆ`--packages: external`ï¼‰

#### ä»•çµ„ã¿
```typescript
// CDK ã§ã®è¨­å®šä¾‹
bundling: {
  esbuildArgs: { '--packages': 'external' },  // å…¨ã¦ã®å¤–éƒ¨ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ãƒãƒ³ãƒ‰ãƒ«ã‹ã‚‰é™¤å¤–
  externalModules: ['@aws-sdk/*'],           // AWS SDK ã‚‚é™¤å¤–ï¼ˆãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã«å«ã¾ã‚Œã‚‹ï¼‰
}
```

#### å®Ÿéš›ã®æ§‹æˆ
```
Lambda é–¢æ•°ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸:
â”œâ”€â”€ index.js (1,087 bytes)    # è‡ªä½œã‚³ãƒ¼ãƒ‰ã®ã¿
â””â”€â”€ ï¼ˆå¤–éƒ¨ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã¯å«ã¾ã‚Œãªã„ï¼‰

Lambda ãƒ¬ã‚¤ãƒ¤ãƒ¼:
â””â”€â”€ nodejs/
    â””â”€â”€ node_modules/
        â”œâ”€â”€ lodash/           # å…±æœ‰ãƒ©ã‚¤ãƒ–ãƒ©ãƒª
        â”œâ”€â”€ date-fns/         # å…±æœ‰ãƒ©ã‚¤ãƒ–ãƒ©ãƒª
        â””â”€â”€ dynamoose/        # å…±æœ‰ãƒ©ã‚¤ãƒ–ãƒ©ãƒª
```

#### ãƒ¡ãƒªãƒƒãƒˆ
- **ãƒ‡ãƒ—ãƒ­ã‚¤ã‚µã‚¤ã‚ºå‰Šæ¸›**: å„ Lambda é–¢æ•°ã¯ 1KB ç¨‹åº¦ã«
- **ãƒ‡ãƒ—ãƒ­ã‚¤é€Ÿåº¦å‘ä¸Š**: ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ã‚³ãƒ¼ãƒ‰ãŒå°ã•ã„
- **å…±æœ‰ã«ã‚ˆã‚‹åŠ¹ç‡åŒ–**: è¤‡æ•°ã®é–¢æ•°ã§åŒã˜ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’å†åˆ©ç”¨
- **ã‚³ãƒ¼ãƒ«ãƒ‰ã‚¹ã‚¿ãƒ¼ãƒˆæ”¹å–„**: é–¢æ•°æœ¬ä½“ãŒè»½é‡

#### ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ
- **ãƒ¬ã‚¤ãƒ¤ãƒ¼ç®¡ç†ã®è¤‡é›‘ã•**: ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†ãŒå¿…è¦
- **ãƒ‡ãƒ—ãƒ­ã‚¤é †åºã®è€ƒæ…®**: ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’å…ˆã«ãƒ‡ãƒ—ãƒ­ã‚¤
- **ã‚µã‚¤ã‚ºåˆ¶é™**: ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¯æœ€å¤§ 5 å€‹ã€åˆè¨ˆ 250MB ã¾ã§

### ãƒ¬ã‚¤ãƒ¤ãƒ¼ãªã—ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼ˆTree shaking ã®ã¿ï¼‰

#### ä»•çµ„ã¿
```typescript
// CDK ã§ã®è¨­å®šä¾‹
bundling: {
  externalModules: ['@aws-sdk/*'],  // AWS SDK ã®ã¿é™¤å¤–
  esbuildArgs: {
    '--tree-shaking': 'true',      // æœªä½¿ç”¨ã‚³ãƒ¼ãƒ‰ã‚’å‰Šé™¤
    '--minify': true,              // ã‚³ãƒ¼ãƒ‰ã‚’æœ€å°åŒ–
  }
}
```

#### å®Ÿéš›ã®æ§‹æˆ
```
Lambda é–¢æ•°ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸:
â”œâ”€â”€ index.js (8,044 bytes)    # è‡ªä½œã‚³ãƒ¼ãƒ‰ + ä½¿ç”¨ã—ã¦ã„ã‚‹å¤–éƒ¨ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®ã¿
â””â”€â”€ ï¼ˆæœªä½¿ç”¨ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã¯ tree shaking ã§é™¤å¤–ï¼‰
```

#### ãƒ¡ãƒªãƒƒãƒˆ
- **ã‚·ãƒ³ãƒ—ãƒ«ãªæ§‹æˆ**: ãƒ¬ã‚¤ãƒ¤ãƒ¼ç®¡ç†ä¸è¦
- **ç‹¬ç«‹æ€§**: å„é–¢æ•°ãŒå¿…è¦ãªã‚‚ã®ã ã‘ã‚’å«ã‚€
- **ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†ãŒå®¹æ˜“**: package.json ã§å®Œçµ

#### ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ
- **ãƒ‡ãƒ—ãƒ­ã‚¤ã‚µã‚¤ã‚ºå¢—åŠ **: å„é–¢æ•°ã«ä¾å­˜é–¢ä¿‚ãŒå«ã¾ã‚Œã‚‹
- **é‡è¤‡**: åŒã˜ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãŒè¤‡æ•°ã®é–¢æ•°ã«å«ã¾ã‚Œã‚‹å¯èƒ½æ€§

### å®Ÿä¾‹ï¼šbilling-processor ã®å ´åˆ

```typescript
// src/lambda/billing-processor/index.ts
import { BillingService } from '../../services/billing-service';
// notification-service ã¯ import ã—ã¦ã„ãªã„ï¼

export const handler = async (event: any) => {
  const billingService = new BillingService();
  // è«‹æ±‚å‡¦ç†ã®ã¿å®Ÿè¡Œ
};
```

**Tree shaking ã®åŠ¹æœ**:
- `notification-service.ts` ã¨ãã®ä¾å­˜é–¢ä¿‚ï¼ˆSNS ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆç­‰ï¼‰ã¯å«ã¾ã‚Œãªã„
- `billing-service.ts` ã¨å¿…è¦ãªä¾å­˜é–¢ä¿‚ã®ã¿ãƒãƒ³ãƒ‰ãƒ«ã•ã‚Œã‚‹
- çµæœ: 8KB ã®è»½é‡ãªé–¢æ•°ã«

### ã©ã¡ã‚‰ã‚’é¸ã¶ã¹ãã‹ï¼Ÿ

| çŠ¶æ³ | æ¨å¥¨ãƒ‘ã‚¿ãƒ¼ãƒ³ | ç†ç”± |
|------|------------|------|
| å¤§è¦æ¨¡ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆï¼ˆ10+ é–¢æ•°ï¼‰ | ãƒ¬ã‚¤ãƒ¤ãƒ¼ä½¿ç”¨ | å…±æœ‰åŠ¹ç‡ãŒé«˜ã„ |
| å°è¦æ¨¡ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆï¼ˆã€œ5 é–¢æ•°ï¼‰ | ãƒ¬ã‚¤ãƒ¤ãƒ¼ãªã— | ç®¡ç†ãŒã‚·ãƒ³ãƒ—ãƒ« |
| é »ç¹ãªãƒ‡ãƒ—ãƒ­ã‚¤ | ãƒ¬ã‚¤ãƒ¤ãƒ¼ä½¿ç”¨ | ãƒ‡ãƒ—ãƒ­ã‚¤æ™‚é–“çŸ­ç¸® |
| é–¢æ•°ã”ã¨ã«ä¾å­˜é–¢ä¿‚ãŒç•°ãªã‚‹ | ãƒ¬ã‚¤ãƒ¤ãƒ¼ãªã— | æŸ”è»Ÿæ€§ãŒé«˜ã„ |
| ãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹ | ãƒ¬ã‚¤ãƒ¤ãƒ¼ãªã— | ç‹¬ç«‹æ€§ã‚’ä¿ã¦ã‚‹ |

## ğŸ“ˆ å®Ÿéš›ã®ãƒ‡ãƒ—ãƒ­ã‚¤çµæœã¨è©³ç´°åˆ†æ

### ãƒ‡ãƒ—ãƒ­ã‚¤ã•ã‚Œã‚‹ Lambda é–¢æ•°ä¸€è¦§

| é–¢æ•°å | å®Ÿéš›ã®ã‚µã‚¤ã‚º | ãƒ¡ãƒ¢ãƒª | èª¬æ˜ |
|--------|-------------|--------|------|
| `sample-function-a-all-external` | **1,087 bytes** | 512 MB | å…¨å¤–éƒ¨ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«é™¤å¤–ï¼ˆãƒ¬ã‚¤ãƒ¤ãƒ¼ä½¿ç”¨ï¼‰ |
| `sample-function-a-specific-external` | **1,087 bytes** | 512 MB | ç‰¹å®šãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«é™¤å¤–ï¼ˆãƒ¬ã‚¤ãƒ¤ãƒ¼ä½¿ç”¨ï¼‰ |
| `sample-billing-processor-optimized` | **8,044 bytes** | 256 MB | Tree shaking ã®ã¿ï¼ˆãƒ¬ã‚¤ãƒ¤ãƒ¼ãªã—ï¼‰ |
| `sample-function-b-with-layer` | **1,138 bytes** | 512 MB | é€šçŸ¥æ©Ÿèƒ½ä»˜ãï¼ˆãƒ¬ã‚¤ãƒ¤ãƒ¼ä½¿ç”¨ï¼‰ |
| `sample-function-a-no-optimization` | **64,802 bytes** | 512 MB | æœ€é©åŒ–ãªã—ï¼ˆãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³ï¼‰ |
| `sample-function-a-full-bundle` | **64,802 bytes** | 512 MB | å…¨ã¦ãƒãƒ³ãƒ‰ãƒ«ï¼ˆæœ€æ‚ªã‚±ãƒ¼ã‚¹ï¼‰ |
| `sample-function-a-without-aws-sdk-exclusion` | **TBD** | 512 MB | @aws-sdk/* é™¤å¤–ãªã—ï¼ˆæ¤œè¨¼ç”¨ï¼‰ |

### ğŸ¯ Tree Shaking ã®ä¾å­˜æ€§åˆ†é›¢åŠ¹æœ

#### å®Ÿè¨¼å®Ÿé¨“: notification-service.ts ã‚’å¤‰æ›´ã—ãŸå ´åˆ

```bash
# ã‚ªãƒ—ã‚·ãƒ§ãƒ³1ã‚’é¸æŠã—ã¦ã€notification-service.tsã«å‡¦ç†è¿½åŠ  & ãƒ‡ãƒ—ãƒ­ã‚¤å½±éŸ¿åˆ†æ
npm run test-dependency-isolation
```

**çµæœ:**
```
=== Deployment Impact Analysis ===
Function                            Changed
sample-billing-processor-optimized  No     âœ… Tree shaking ãŒåŠ¹ã„ã¦ã„ã‚‹ï¼
sample-function-b-with-layer        Yes    âœ… æœŸå¾…é€šã‚Šï¼ˆé€šçŸ¥æ©Ÿèƒ½ã‚’ä½¿ç”¨ï¼‰
sample-function-a-all-external      No     âœ… å½±éŸ¿ãªã—
```

### ğŸ’¡ ä½•ãŒãƒ‡ãƒ—ãƒ­ã‚¤ã•ã‚Œã‚‹ã®ã‹ï¼Ÿ

#### 1. ãƒ¬ã‚¤ãƒ¤ãƒ¼ä½¿ç”¨æ™‚ï¼ˆ1,087 bytes ã®é–¢æ•°ï¼‰

**Lambda é–¢æ•°ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ä¸­èº«:**
```javascript
// index.js (ãƒãƒ³ãƒ‰ãƒ«å¾Œ)
// è‡ªä½œã‚³ãƒ¼ãƒ‰ã®ã¿ãŒå«ã¾ã‚Œã‚‹
import { handler } from './handler';
import { validateInput } from './utils';
// å¤–éƒ¨ãƒ©ã‚¤ãƒ–ãƒ©ãƒªï¼ˆlodash, date-fnsï¼‰ã¸ã®å‚ç…§ã¯ã‚ã‚‹ãŒã€
// å®Ÿä½“ã¯ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‹ã‚‰èª­ã¿è¾¼ã¾ã‚Œã‚‹
```

**Lambda ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ä¸­èº«:**
```
SharedDependenciesLayer/
â””â”€â”€ nodejs/
    â””â”€â”€ node_modules/
        â”œâ”€â”€ lodash/          (600KB)
        â”œâ”€â”€ date-fns/        (350KB)
        â””â”€â”€ dynamoose/       (450KB)
        åˆè¨ˆ: ç´„1.4MB
```

#### 2. Tree Shaking ã®ã¿ï¼ˆ8,044 bytes ã®é–¢æ•°ï¼‰

**Lambda é–¢æ•°ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ä¸­èº«:**
```javascript
// index.js (ãƒãƒ³ãƒ‰ãƒ«å¾Œ)
// è‡ªä½œã‚³ãƒ¼ãƒ‰ + å®Ÿéš›ã«ä½¿ç”¨ã—ã¦ã„ã‚‹éƒ¨åˆ†ã®ã¿
import { format } from 'date-fns';  // ä½¿ç”¨ã™ã‚‹é–¢æ•°ã®ã¿å«ã¾ã‚Œã‚‹
import { get } from 'lodash';       // ä½¿ç”¨ã™ã‚‹é–¢æ•°ã®ã¿å«ã¾ã‚Œã‚‹
// notification-service ã¯å«ã¾ã‚Œãªã„ï¼ˆimport ã—ã¦ã„ãªã„ãŸã‚ï¼‰
```

#### 3. æœ€é©åŒ–ãªã—ï¼ˆ64,802 bytes ã®é–¢æ•°ï¼‰

**Lambda é–¢æ•°ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ä¸­èº«:**
```javascript
// index.js (ãƒãƒ³ãƒ‰ãƒ«å¾Œ)
// å…¨ã¦ãŒå«ã¾ã‚Œã‚‹
- è‡ªä½œã‚³ãƒ¼ãƒ‰å…¨ã¦
- lodash å…¨ä½“ (600KB -> minifyå¾Œ)
- date-fns å…¨ä½“ (350KB -> minifyå¾Œ)
- ä½¿ã£ã¦ã„ãªã„ notification-service ã‚‚å«ã¾ã‚Œã‚‹å¯èƒ½æ€§
```

### ğŸš€ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã¸ã®å½±éŸ¿

| ãƒ¡ãƒˆãƒªã‚¯ã‚¹ | ãƒ¬ã‚¤ãƒ¤ãƒ¼ä½¿ç”¨ | Tree Shaking ã®ã¿ | æœ€é©åŒ–ãªã— |
|-----------|------------|----------------|-----------|
| ã‚³ãƒ¼ãƒ«ãƒ‰ã‚¹ã‚¿ãƒ¼ãƒˆ | æœ€é€Ÿ (ã€œ200ms) | é€Ÿã„ (ã€œ250ms) | é…ã„ (ã€œ400ms) |
| ãƒ‡ãƒ—ãƒ­ã‚¤æ™‚é–“ | 10ç§’ | 15ç§’ | 30ç§’ |
| ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ | æœ€å° | å° | å¤§ |
| ç®¡ç†ã®è¤‡é›‘ã• | ä¸­ | ä½ | æœ€ä½ |

### ğŸ”§ å®Ÿè£…ã®ãƒã‚¤ãƒ³ãƒˆ

1. **ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’ä½¿ã†å ´åˆã¯å¿…ãš `--packages: external` ã‚’æŒ‡å®š**
   ```typescript
   esbuildArgs: { '--packages': 'external' }
   ```

2. **Tree Shaking ã‚’æœ€å¤§é™æ´»ç”¨ã™ã‚‹ã«ã¯**
   - åå‰ä»˜ãã‚¤ãƒ³ãƒãƒ¼ãƒˆã‚’ä½¿ç”¨: `import { format } from 'date-fns'`
   - ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚¤ãƒ³ãƒãƒ¼ãƒˆã‚’é¿ã‘ã‚‹: `import * as _ from 'lodash'` âŒ

3. **ä¾å­˜æ€§ã®å¤‰æ›´ã‚’è¿½è·¡ã™ã‚‹ã«ã¯**
   - CDK ã®ãƒãƒƒã‚·ãƒ¥å€¤ã‚’ç¢ºèª
   - CloudFormation ã®å¤‰æ›´ã‚»ãƒƒãƒˆã‚’ç¢ºèª

## ğŸš€ å®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³

### ãƒ‘ã‚¿ãƒ¼ãƒ³1: å…¨å¤–éƒ¨ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«é™¤å¤–
```typescript
bundling: {
  esbuildArgs: { '--packages': 'external' },
  externalModules: ['@aws-sdk/*'],
}
```

### ãƒ‘ã‚¿ãƒ¼ãƒ³2: ç‰¹å®šãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«é™¤å¤–
```typescript
bundling: {
  externalModules: ['@aws-sdk/*', 'lodash', 'date-fns'],
}
```

### ãƒ‘ã‚¿ãƒ¼ãƒ³3: Tree shaking æœ€é©åŒ–
```typescript
bundling: {
  esbuildArgs: { '--tree-shaking': 'true' },
  externalModules: ['@aws-sdk/*'],
}
```

## ğŸ”¬ ä¾å­˜æ€§åˆ†é›¢ã®æ¤œè¨¼

```bash
# æœªå‚ç…§ã‚³ãƒ¼ãƒ‰å¤‰æ›´ã«ã‚ˆã‚‹å½±éŸ¿ç¯„å›²ãƒ†ã‚¹ãƒˆ
./scripts/test-dependency-isolation.sh

# çµæœä¾‹:
# billing-processor updated: No âœ…
# function-b updated: Yes (expected)
```

Tree shaking ã«ã‚ˆã‚Šã€æœªå‚ç…§ã‚³ãƒ¼ãƒ‰ã®å¤‰æ›´ã¯è©²å½“ Lambda ã®å†ãƒ‡ãƒ—ãƒ­ã‚¤ã‚’å¼•ãèµ·ã“ã—ã¾ã›ã‚“ã€‚

## ğŸ“¦ ä½¿ç”¨æ–¹æ³•

### å‰ææ¡ä»¶

```bash
# å¿…è¦ãªãƒ„ãƒ¼ãƒ«
npm install -g aws-cdk
aws configure  # AWSèªè¨¼æƒ…å ±è¨­å®š
```

### ãƒ‡ãƒ—ãƒ­ã‚¤ã¨æ¤œè¨¼

```bash
# 1. ä¾å­˜é–¢ä¿‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
npm install

# 2. å…±æœ‰ãƒ¬ã‚¤ãƒ¤ãƒ¼æ§‹ç¯‰
npm run build-layer

# 3. çµ±åˆãƒ‡ãƒ—ãƒ­ã‚¤ãƒ»ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
npm run deploy-and-test

# 4. ä¾å­˜æ€§åˆ†é›¢æ¤œè¨¼
npm run test-dependency-isolation
```

### ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—

```bash
npm run cleanup
```

## ğŸ›  ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹æˆ
ã‚ãã¾ã§ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ã§ã™ã€‚
ä½•ã‚‚å…·ä½“çš„ã«ãªãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ãªã©ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚

```
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ lambda/                    # Lambda é–¢æ•°
â”‚   â”‚   â”œâ”€â”€ billing-processor/     # èª²é‡‘å‡¦ç†ï¼ˆnotification-service æœªä½¿ç”¨ï¼‰
â”‚   â”‚   â”œâ”€â”€ function-a/            # åŸºæœ¬æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆç”¨
â”‚   â”‚   â””â”€â”€ function-b/            # é€šçŸ¥æ©Ÿèƒ½ï¼ˆnotification-service ä½¿ç”¨ï¼‰
â”‚   â”œâ”€â”€ services/                  # ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯
â”‚   â”‚   â”œâ”€â”€ billing-service.ts     # èª²é‡‘ã‚µãƒ¼ãƒ“ã‚¹
â”‚   â”‚   â””â”€â”€ notification-service.ts # é€šçŸ¥ã‚µãƒ¼ãƒ“ã‚¹
â”‚   â””â”€â”€ repositories/              # ãƒ‡ãƒ¼ã‚¿ã‚¢ã‚¯ã‚»ã‚¹å±¤
â”œâ”€â”€ layers/
â”‚   â””â”€â”€ shared-dependencies/       # å…±æœ‰å¤–éƒ¨ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«
â”œâ”€â”€ scripts/                       # æ¤œè¨¼ã‚¹ã‚¯ãƒªãƒ—ãƒˆç¾¤
â””â”€â”€ lib/                          # CDK ã‚¹ã‚¿ãƒƒã‚¯å®šç¾©
```

